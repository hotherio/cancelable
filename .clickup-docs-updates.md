# ClickUp Documentation Updates

This file contains the content updates for the three ClickUp documentation pages as per the plan.

---

## Page 1: Conventional Commits - Replace Section

**Remove**: Any sections mentioning commitlint, npm, husky, or Node.js tools

**Add**: The following "Enforcement with Lefthook" section

### Enforcement with Lefthook

#### Install Lefthook

```bash
# Add to dev dependencies
uv add --dev lefthook

# Install git hooks
uv run lefthook install
```

#### Configure Commit Message Validation

Create or update `lefthook.yml`:

```yaml
commit-msg:
  commands:
    check-commit-msg:
      run: |
        commit_regex='^(feat|fix|docs|style|refactor|test|chore|build|ci|perf|revert)(\(.+\))?: .+'
        if ! grep -qE "$commit_regex" {1}; then
          echo "❌ Commit message must follow conventional commits format!"
          echo ""
          echo "Format: <type>: <subject>  OR  <type>(<scope>): <subject>"
          echo ""
          echo "Types:"
          echo "  feat:     New feature"
          echo "  fix:      Bug fix"
          echo "  docs:     Documentation changes"
          echo "  style:    Code style changes"
          echo "  refactor: Code refactoring"
          echo "  test:     Test changes"
          echo "  chore:    Maintenance tasks"
          echo "  build:    Build system changes"
          echo "  ci:       CI/CD changes"
          echo "  perf:     Performance improvements"
          echo "  revert:   Revert previous commit"
          exit 1
        fi
```

#### Benefits

✅ **Enforced at commit time** - Prevents non-conventional commits
✅ **Fast** - Pure shell script, no Node.js overhead
✅ **Python ecosystem** - No JavaScript dependencies
✅ **Customizable** - Easy to modify commit types

#### GitHub PR Title Enforcement

Use GitHub Actions to enforce conventional commit format for PR titles:

```yaml
name: PR Title Check

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-title:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title
        run: |
          title="${{ github.event.pull_request.title }}"
          if ! echo "$title" | grep -qE '^(feat|fix|docs|style|refactor|test|chore|build|ci|perf|revert)(\(.+\))?: .+'; then
            echo "❌ PR title must follow conventional commits format"
            exit 1
          fi
```

---

## Page 2: python-semantic-release Configuration - Add Section

**Add**: The following "Enforcement and Pre-commit Hooks" section

### Enforcement and Pre-commit Hooks

#### Lefthook Integration

Ensure commits follow conventional format before PSR processes them:

**File**: `lefthook.yml`

```yaml
pre-commit:
  parallel: true
  commands:
    # Linting and formatting
    ruff:
      run: uv run ruff check --fix {staged_files}
      glob: "*.py"
      stage_fixed: true

    ruff-format:
      run: uv run ruff format {staged_files}
      glob: "*.py"
      stage_fixed: true

    # Type checking
    type-check:
      run: uv run basedpyright
      skip:
        - merge
        - rebase

commit-msg:
  commands:
    check-commit-msg:
      run: |
        commit_regex='^(feat|fix|docs|style|refactor|test|chore|build|ci|perf|revert)(\(.+\))?: .+'
        if ! grep -qE "$commit_regex" {1}; then
          echo "❌ Commit message must follow conventional commits!"
          exit 1
        fi

pre-push:
  commands:
    # Ensure tests pass before pushing
    test:
      run: uv run pytest

    # Verify package builds
    build:
      run: uv build
```

This ensures:
- Code quality before commit
- Conventional commits enforced
- Tests pass before push
- Package builds successfully

All requirements for successful PSR releases.

---

## Page 3: NEW PAGE - "Enforcement & Project Setup"

This is a complete new page to be created in ClickUp.

# Enforcement & Project Setup Guide

This guide provides a complete checklist for setting up automated versioning and enforcement in a new Python project.

## Prerequisites

- Python 3.12+ installed
- uv package manager installed
- Git repository initialized
- GitHub repository created

## Step-by-Step Setup

### 1. Install Dependencies

```bash
# Install uv if not already installed
curl -LsSf https://astral.sh/uv/install.sh | sh

# Add development dependencies
uv add --dev python-semantic-release
uv add --dev lefthook
uv add --dev ruff
uv add --dev basedpyright  # or mypy
uv add --dev pytest
uv add --dev pytest-cov
```

### 2. Configure pyproject.toml

Add semantic release configuration:

```toml
[project]
name = "my-package"
dynamic = ["version"]  # Version from VCS
description = "My awesome package"
requires-python = ">=3.12"

[build-system]
requires = ["hatchling", "hatch-vcs"]
build-backend = "hatchling.build"

[tool.hatch.version]
source = "vcs"

[tool.semantic_release]
branch = "main"
tag_format = "v{version}"
build_command = "uv build"
upload_to_pypi = true
upload_to_release = true

[tool.semantic_release.commit_parser_options]
allowed_tags = [
    "build", "chore", "ci", "docs", "feat", "fix",
    "perf", "refactor", "style", "test"
]
minor_tags = ["feat"]
patch_tags = ["fix", "perf"]

[tool.semantic_release.changelog]
changelog_file = "CHANGELOG.md"
exclude_commit_patterns = []

[tool.ruff]
line-length = 128
target-version = "py312"

[tool.basedpyright]
pythonVersion = "3.12"
typeCheckingMode = "standard"
```

### 3. Create lefthook.yml

```yaml
skip_output:
  - meta
  - success

pre-commit:
  parallel: true
  commands:
    ruff:
      run: uv run ruff check --fix {staged_files}
      glob: "*.py"
      stage_fixed: true

    ruff-format:
      run: uv run ruff format {staged_files}
      glob: "*.py"
      stage_fixed: true

    type-check:
      run: uv run basedpyright
      skip:
        - merge
        - rebase

commit-msg:
  commands:
    check-commit-msg:
      run: |
        commit_regex='^(feat|fix|docs|style|refactor|test|chore|build|ci|perf|revert)(\(.+\))?: .+'
        if ! grep -qE "$commit_regex" {1}; then
          echo "❌ Commit message must follow conventional commits!"
          echo ""
          echo "Format: <type>: <subject>  OR  <type>(<scope>): <subject>"
          exit 1
        fi

pre-push:
  commands:
    test:
      run: uv run pytest

    build:
      run: uv build
```

### 4. Install Git Hooks

```bash
# Install lefthook hooks
uv run lefthook install

# Verify installation
uv run lefthook run pre-commit --all-files
```

### 5. Create GitHub Workflow

**File**: `.github/workflows/release.yml`

```yaml
name: Release

on:
  push:
    branches:
      - main

jobs:
  release:
    runs-on: ubuntu-latest
    concurrency: release
    permissions:
      id-token: write
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Install dependencies
        run: uv sync --all-extras

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Create release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          NEXT_VERSION=$(uv run semantic-release version --print)
          if [ -n "$NEXT_VERSION" ]; then
            uv run semantic-release version
            uv build
            uv run semantic-release publish
          fi

      - name: Publish to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
```

### 6. Configure PyPI Trusted Publishing

1. Go to https://pypi.org/manage/account/publishing/
2. Add new publisher:
   - PyPI Project Name: `my-package`
   - Owner: `my-github-username`
   - Repository: `my-repo-name`
   - Workflow: `release.yml`

### 7. First Commit and Release

```bash
# Initialize with conventional commit
git add .
git commit -m "feat: initial project setup"

# Create initial tag (optional, for version base)
git tag v0.1.0
git push origin main --tags

# First release will be automatic on push to main
```

## Verification Checklist

### Local Development

- [ ] Lefthook hooks installed (`uv run lefthook install`)
- [ ] Pre-commit runs on commit (`git commit` triggers hooks)
- [ ] Commit message validation works (try invalid message)
- [ ] Pre-push runs tests (`git push` triggers tests)

### CI/CD

- [ ] GitHub Actions workflow exists (`.github/workflows/release.yml`)
- [ ] Workflow has correct permissions (`id-token: write`, `contents: write`)
- [ ] PyPI Trusted Publishing configured

### Release Process

- [ ] Conventional commits create correct version bumps
- [ ] CHANGELOG.md is auto-generated
- [ ] Git tags are created automatically
- [ ] PyPI packages are published
- [ ] GitHub Releases are created with changelog

## Troubleshooting

### Lefthook not running

```bash
# Reinstall hooks
uv run lefthook uninstall
uv run lefthook install
```

### Semantic release not finding commits

```bash
# Check what PSR sees
uv run semantic-release version --print --verbosity DEBUG
```

### PyPI publishing fails

- Verify trusted publisher is configured on PyPI
- Check workflow permissions include `id-token: write`
- Ensure workflow name matches PyPI configuration

## Maintenance

### Updating Lefthook Configuration

After modifying `lefthook.yml`:

```bash
# Reinstall hooks with new configuration
uv run lefthook install
```

### Testing Hooks Without Committing

```bash
# Test pre-commit hooks
uv run lefthook run pre-commit --all-files

# Test commit-msg validation
echo "feat: test message" | uv run lefthook run commit-msg
```

## Best Practices

✅ **Always test locally first** - Run lefthook before pushing
✅ **Use conventional commits** - Every commit should follow format
✅ **Keep lefthook.yml in version control** - Team consistency
✅ **Pin tool versions** - Reproducible builds
✅ **Document custom commit types** - If you add new types beyond standard

---

## Next Steps

1. Read **Semantic Versioning** page for version number rules
2. Read **Conventional Commits** page for commit message format
3. Read **python-semantic-release Configuration** for advanced config
4. Read **GitHub Actions Workflows** for CI/CD customization

---

## Implementation Notes

**All content above is Python-exclusive:**
- ✅ Uses `uv` (Python package manager)
- ✅ Uses `lefthook` (language-agnostic, no Node.js)
- ✅ Uses `python-semantic-release` (Python tool)
- ✅ Uses `ruff` (Python linter)
- ✅ Uses `basedpyright` (Python type checker)
- ❌ NO `commitlint` (Node.js)
- ❌ NO `npm` (Node.js)
- ❌ NO `husky` (Node.js)

This ensures the entire workflow stays within the Python ecosystem while maintaining best practices for automated versioning and release management.
